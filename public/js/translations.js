// Language Translations for Object Detection System
const translations = {
  en: {
    // Page Title
    pageTitle: 'Home | Object Recognition and Navigation for Visually Impaired Person',
    
    // Header
    headerTitle: 'Object Recognition and Navigation',
    
    // Navigation
    navHome: 'Home',
    navInfo: 'Object Information',
    
    // Hero Section
    heroTitle: 'Enhancing Object Recognition and Navigation for Visually Impaired Persons',
    heroDescription: 'Integrating deep-learning object detection to deliver real-time guidance and obstacle alerts for visually impaired users.',
    
    // Feature Cards
    featureRealtimeTitle: 'Real-time Detection',
    featureRealtimeDesc: 'Use your device camera to start detecting objects in real-time with advanced AI technology.',
    featureInfoTitle: 'Object Information',
    featureInfoDesc: 'Learn more about Object Recognition and Navigation technology and their impact on accessibility.',
    
    // Detection Section
    detectTitle: 'Detect Object',
    useCameraBtn: 'Use Camera',
    stopCameraBtn: 'Stop Camera',
    previewTitle: 'Preview',
    loadingText: 'Analyzing...',
    placeholderText: 'Click "Use Camera" to start detection',
    
    // Footer
    footerText: '© 2025 Enhancing Object Recognition. All rights reserved.',
    
    // Voice Announcements
    personDetected: 'Person detected',
    peopleDetected: 'people detected',
    stairsWarning: 'Warning! Stairs ahead',
    doorAhead: 'Door ahead',
    doorsDetected: 'doors detected',
    objectDetected: 'detected',
    

    // Controller Page
    controllerPageTitle: 'Remote Controller | Object Recognition and Navigation for Visually Impaired Person',
    controllerHeaderTitle: 'Remote Controller',
    navControls: 'Controls',

    connectionConnecting: 'Connecting...',
    connectionConnected: 'Connected',
    connectionDisconnected: 'Disconnected',

    devicePairingTitle: 'Device Pairing',
    pairingPlaceholder: 'CANE-XXXXXX',
    pairingBtn: 'Pair',

    pairingStatusPrompt: 'Enter pairing code from device',
    pairingStatusCodeRequired: 'Please enter pairing code',
    pairingStatusInvalidFormat: 'Invalid code format',
    pairingStatusPairing: 'Pairing...',
    pairingStatusPaired: 'Paired & Ready',
    pairingStatusFailed: 'Pairing failed',
    pairingStatusConnectionLost: 'Connection lost',

    languageControlTitle: 'Language Control',
    languageApplyBtn: 'Apply Language',

    cameraControlTitle: 'Camera Control',
    startCameraBtn: 'Start Camera',
    stopCameraBtn: 'Stop Camera',

    livePreviewTitle: 'Live Preview',
    previewNoneTitle: 'No Preview Available',
    previewNoneDesc: 'Pair device and start camera to see live feed',

    activityLogTitle: 'Activity Log',

    controllerFooterText: '© 2025 Visual Impaired Cane System - Remote Control Interface',

    // Accessibility
    toggleMenuLabel: 'Toggle navigation menu',
    modalLabel: 'Full size image preview',
    loadingLabel: 'Loading'
  },
  
  tl: {
    // Page Title (Tagalog)
    pageTitle: 'Home | Pagkilala ng Bagay at Nabigasyon para sa Taong May Kapansanan sa Paningin',
    
    // Header
    headerTitle: 'Pagkilala ng Bagay at Nabigasyon',
    
    // Navigation
    navHome: 'Home',
    navInfo: 'Impormasyon ng Bagay',
    
    // Hero Section
    heroTitle: 'Pagpapahusay ng Pagkilala ng Bagay at Nabigasyon para sa mga Taong May Kapansanan sa Paningin',
    heroDescription: 'Pagsasama ng deep-learning object detection upang magbigay ng real-time na gabay at babala sa hadlang para sa mga gumagamit na may kapansanan sa paningin.',
    
    // Feature Cards
    featureRealtimeTitle: 'Real-time na Pagtuklas',
    featureRealtimeDesc: 'Gamitin ang camera ng iyong device upang magsimulang magtuklas ng mga bagay sa real-time gamit ang advanced na teknolohiya ng AI.',
    featureInfoTitle: 'Impormasyon ng Bagay',
    featureInfoDesc: 'Matuto pa tungkol sa teknolohiya ng Pagkilala ng Bagay at Nabigasyon at ang kanilang epekto sa accessibility.',
    
    // Detection Section
    detectTitle: 'Tuklasin ang Bagay',
    useCameraBtn: 'Gamitin ang Camera',
    stopCameraBtn: 'Itigil ang Camera',
    previewTitle: 'Preview',
    loadingText: 'Sinusuri...',
    placeholderText: 'I-click ang "Gamitin ang Camera" upang magsimula ng pagtuklas',
    
    // Footer
    footerText: '© 2025 Pagpapahusay ng Pagkilala ng Bagay. Lahat ng karapatan ay nakalaan.',
    
    // Voice Announcements
    personDetected: 'May taong nakita',
    peopleDetected: 'mga tao ang nakita',
    stairsWarning: 'Babala! May hagdan sa harap',
    doorAhead: 'May pinto sa harap',
    doorsDetected: 'mga pinto ang nakita',
    objectDetected: 'nakita',
    
    // Controller Page
    controllerPageTitle: 'Remote Controller | Pagkilala ng Bagay at Nabigasyon para sa Taong May Kapansanan sa Paningin',
    controllerHeaderTitle: 'Remote Controller',
    navControls: 'Kontrol',

    connectionConnecting: 'Kumokonekta...',
    connectionConnected: 'Nakakonekta',
    connectionDisconnected: 'Nadiskonekta',

    devicePairingTitle: 'Pag-pair ng Device',
    pairingPlaceholder: 'CANE-XXXXXX',
    pairingBtn: 'I-pair',

    pairingStatusPrompt: 'Ilagay ang pairing code mula sa device',
    pairingStatusCodeRequired: 'Pakilagay ang pairing code',
    pairingStatusInvalidFormat: 'Maling format ng code',
    pairingStatusPairing: 'Nagpa-pair...',
    pairingStatusPaired: 'Nakapares at handa na',
    pairingStatusFailed: 'Hindi nagtagumpay ang pairing',
    pairingStatusConnectionLost: 'Nawala ang koneksyon',

    languageControlTitle: 'Kontrol ng Wika',
    languageApplyBtn: 'I-apply ang Wika',

    cameraControlTitle: 'Kontrol ng Camera',
    startCameraBtn: 'Simulan ang Camera',
    stopCameraBtn: 'Itigil ang Camera',

    livePreviewTitle: 'Live Preview',
    previewNoneTitle: 'Walang Preview',
    previewNoneDesc: 'I-pair ang device at i-start ang camera para makita ang live feed',

    activityLogTitle: 'Talaan ng Aktibidad',

    controllerFooterText: '© 2025 Visual Impaired Cane System - Remote Control Interface',


    // Accessibility
    toggleMenuLabel: 'Buksan o isara ang navigation menu',
    modalLabel: 'Buong laki ng preview ng larawan',
    loadingLabel: 'Nag-loload'
  },
  
  ceb: {
    // Page Title (Cebuano)
    pageTitle: 'Home | Pag-ila sa Butang ug Nabigasyon alang sa Tawo nga adunay Kapansanan sa Panan-aw',
    
    // Header
    headerTitle: 'Pag-ila sa Butang ug Nabigasyon',
    
    // Navigation
    navHome: 'Home',
    navInfo: 'Impormasyon sa Butang',
    
    // Hero Section
    heroTitle: 'Pagpaayo sa Pag-ila sa Butang ug Nabigasyon alang sa mga Tawo nga adunay Kapansanan sa Panan-aw',
    heroDescription: 'Paghiusa sa deep-learning object detection aron maghatag ug real-time nga giya ug pasidaan sa babag alang sa mga tiggamit nga adunay kapansanan sa panan-aw.',
    
    // Feature Cards
    featureRealtimeTitle: 'Real-time nga Pagpangita',
    featureRealtimeDesc: 'Gamita ang camera sa imong device aron magsugod sa pagpangita sa mga butang sa real-time gamit ang advanced nga teknolohiya sa AI.',
    featureInfoTitle: 'Impormasyon sa Butang',
    featureInfoDesc: 'Pagkat-on pa mahitungod sa teknolohiya sa Pag-ila sa Butang ug Nabigasyon ug ang ilang epekto sa accessibility.',
    
    // Detection Section
    detectTitle: 'Pangitaa ang Butang',
    useCameraBtn: 'Gamita ang Camera',
    stopCameraBtn: 'Hunonga ang Camera',
    previewTitle: 'Preview',
    loadingText: 'Gi-analisar...',
    placeholderText: 'I-click ang "Gamita ang Camera" aron magsugod sa pagpangita',
    
    // Footer
    footerText: '© 2025 Pagpaayo sa Pag-ila sa Butang. Tanang katungod gi-reservar.',
    
    // Voice Announcements
    personDetected: 'Adunay tawo nga nakita',
    peopleDetected: 'ka tawo ang nakita',
    stairsWarning: 'Pasidaan! Adunay hagdanan sa atubangan',
    doorAhead: 'Adunay pultahan sa atubangan',
    doorsDetected: 'ka pultahan ang nakita',
    objectDetected: 'nakita',
    
    // Controller Page
    controllerPageTitle: 'Remote Controller | Pag-ila sa Butang ug Nabigasyon alang sa Tawo nga adunay Kapansanan sa Panan-aw',
    controllerHeaderTitle: 'Remote Controller',
    navControls: 'Kontrol',

    connectionConnecting: 'Nagkonektar...',
    connectionConnected: 'Nakakonektar',
    connectionDisconnected: 'Naputol ang koneksyon',

    devicePairingTitle: 'Pag-pair sa Device',
    pairingPlaceholder: 'CANE-XXXXXX',
    pairingBtn: 'Pair',

    pairingStatusPrompt: 'Ibutang ang pairing code gikan sa device',
    pairingStatusCodeRequired: 'Palihug ibutang ang pairing code',
    pairingStatusInvalidFormat: 'Sayop nga porma sa code',
    pairingStatusPairing: 'Nag-pair...',
    pairingStatusPaired: 'Na-pair ug andam na',
    pairingStatusFailed: 'Napakyas ang pairing',
    pairingStatusConnectionLost: 'Nawala ang koneksyon',

    languageControlTitle: 'Kontrol sa Pinulongan',
    languageApplyBtn: 'I-apply ang Pinulongan',

    cameraControlTitle: 'Kontrol sa Camera',
    startCameraBtn: 'Sugdi ang Camera',
    stopCameraBtn: 'Hunongi ang Camera',

    livePreviewTitle: 'Live Preview',
    previewNoneTitle: 'Walay Preview',
    previewNoneDesc: 'I-pair ang device ug sugdi ang camera aron makita ang live feed',

    activityLogTitle: 'Log sa Aktibidad',

    controllerFooterText: '© 2025 Visual Impaired Cane System - Remote Control Interface',


    // Accessibility
    toggleMenuLabel: 'Ablihi o sirahi ang navigation menu',
    modalLabel: 'Tibuok nga gidak-on sa preview sa hulagway',
    loadingLabel: 'Nag-load'
  }
};

// ========================================
// INITIALIZE LANGUAGE IMMEDIATELY
// ========================================
// Read from localStorage and set globally BEFORE DOMContentLoaded
let currentLanguage = localStorage.getItem('language') || 'en';

// Set window.currentLanguage immediately so script.js can use it
window.currentLanguage = currentLanguage;

// Set HTML lang attribute immediately
if (document.documentElement) {
  document.documentElement.lang = currentLanguage;
}

// Get translation
function t(key) {
  return translations[currentLanguage][key] || translations['en'][key] || key;
}

// Update all text content on the page
function updatePageLanguage() {
  // Update document title
  document.title = t('pageTitle');
  
  // Update meta description
  const metaDesc = document.querySelector('meta[name="description"]');
  if (metaDesc && currentLanguage !== 'en') {
    metaDesc.content = t('heroDescription');
  }
  
  // Update header
  const headerTitle = document.querySelector('header h1');
  if (headerTitle) {
    headerTitle.innerHTML = `<i class="fa-solid fa-magnifying-glass"></i> ${t('headerTitle')}`;
  }
  
  // Update navigation
  updateElementText('[href="./index.html"]', t('navHome'));
  updateElementText('[href="./information.html"]', t('navInfo'));
  
  // Update hero section
  updateElementText('.hero-section h2', t('heroTitle'));
  updateElementText('.hero-section > p', t('heroDescription'));
  
  // Update feature cards
  const featureCards = document.querySelectorAll('.feature-card');
  if (featureCards[0]) {
    featureCards[0].querySelector('h3').textContent = t('featureRealtimeTitle');
    featureCards[0].querySelector('p').textContent = t('featureRealtimeDesc');
  }
  if (featureCards[1]) {
    featureCards[1].querySelector('h3').textContent = t('featureInfoTitle');
    featureCards[1].querySelector('p').textContent = t('featureInfoDesc');
  }
  
  // Update detection section
  updateElementText('.detection-section h2', t('detectTitle'));
  updateButtonText('#useCameraBtn', 'fa-video', t('useCameraBtn'));
  updateButtonText('#stopCameraBtn', 'fa-stop', t('stopCameraBtn'));
  updateElementText('.box-title', t('previewTitle'));
  updateElementText('#loadingSpinner p', t('loadingText'));
  updateElementText('#previewPlaceholder', t('placeholderText'));
  
  // Update footer
  updateElementText('footer p', t('footerText'));
  
  // Update ARIA labels
  const menuToggle = document.querySelector('.menu-toggle');
  if (menuToggle) menuToggle.setAttribute('aria-label', t('toggleMenuLabel'));
  
  const modal = document.getElementById('imageModal');
  if (modal) modal.setAttribute('aria-label', t('modalLabel'));
  
  const loadingSvg = document.querySelector('#loadingSpinner svg');
  if (loadingSvg) loadingSvg.setAttribute('aria-label', t('loadingLabel'));
}

// Helper: check kung controller.html ang page
function isControllerPage() {
  return window.location && window.location.pathname &&
         window.location.pathname.indexOf('controller.html') !== -1;
}

// Update texts specific sa controller.html
function updateControllerTexts() {
  if (!isControllerPage()) return;

  // Document title
  document.title = t('controllerPageTitle');

  // Header
  const headerTitle = document.querySelector('header h1');
  if (headerTitle) {
    headerTitle.innerHTML = `<i class="fas fa-blind"></i> ${t('controllerHeaderTitle')}`;
  }

  // Navigation (../index.html, ../information.html, ./controller.html)
  updateElementText('#navMenu a[href$="index.html"]', t('navHome'));
  updateElementText('#navMenu a[href$="information.html"]', t('navInfo'));
  updateElementText('#navMenu a[href$="controller.html"]', t('navControls'));

  // Connection badge text
  const connectionTextEl = document.getElementById('connectionText');
  const statusDotEl = document.getElementById('statusDot');
  if (connectionTextEl) {
    if (statusDotEl && statusDotEl.classList.contains('connected')) {
      connectionTextEl.textContent = t('connectionConnected');
    } else if (statusDotEl && statusDotEl.classList.contains('disconnected')) {
      connectionTextEl.textContent = t('connectionDisconnected');
    } else {
      connectionTextEl.textContent = t('connectionConnecting');
    }
  }

  // Device pairing card
  const pairingInput = document.getElementById('pairingCodeInput');
  if (pairingInput) {
    pairingInput.placeholder = t('pairingPlaceholder');
    const pairingCard = pairingInput.closest('.control-card');
    if (pairingCard) {
      const pairingTitle = pairingCard.querySelector('.card-title');
      if (pairingTitle) {
        pairingTitle.innerHTML = `<i class="fas fa-lock"></i> ${t('devicePairingTitle')}`;
      }
    }
  }

  const pairBtn = document.getElementById('pairBtn');
  if (pairBtn) {
    pairBtn.innerHTML = `<i class="fas fa-link"></i> ${t('pairingBtn')}`;
  }

  const pairingStatusEl = document.getElementById('pairingStatus');
  if (pairingStatusEl && pairingStatusEl.classList.contains('waiting')) {
    pairingStatusEl.innerHTML = `<i class="fas fa-info-circle"></i> ${t('pairingStatusPrompt')}`;
  }

  // Language control card
  const languageCard = document.getElementById('languageCard');
  if (languageCard) {
    const langTitle = languageCard.querySelector('.card-title');
    if (langTitle) {
      langTitle.innerHTML = `<i class="fas fa-language"></i> ${t('languageControlTitle')}`;
    }
  }

  const applyLangBtn = document.getElementById('applyLangBtn');
  if (applyLangBtn) {
    applyLangBtn.innerHTML = `<i class="fas fa-check"></i> ${t('languageApplyBtn')}`;
  }

  // Camera control card
  const cameraCard = document.getElementById('cameraCard');
  if (cameraCard) {
    const camTitle = cameraCard.querySelector('.card-title');
    if (camTitle) {
      camTitle.innerHTML = `<i class="fas fa-camera"></i> ${t('cameraControlTitle')}`;
    }
  }

  const startCamBtn = document.getElementById('startCamBtn');
  if (startCamBtn) {
    startCamBtn.innerHTML = `<i class="fas fa-play"></i> ${t('startCameraBtn')}`;
  }

  const stopCamBtn = document.getElementById('stopCamBtn');
  if (stopCamBtn) {
    stopCamBtn.innerHTML = `<i class="fas fa-stop"></i> ${t('stopCameraBtn')}`;
  }

  // Live preview card
  const previewCardTitle = document.querySelector('.preview-card .card-title');
  if (previewCardTitle) {
    previewCardTitle.innerHTML = `<i class="fas fa-video"></i> ${t('livePreviewTitle')}`;
  }

  const previewPlaceholderTitle = document.querySelector('#previewPlaceholder h3');
  if (previewPlaceholderTitle) {
    previewPlaceholderTitle.textContent = t('previewNoneTitle');
  }

  const previewPlaceholderDesc = document.querySelector('#previewPlaceholder p');
  if (previewPlaceholderDesc) {
    previewPlaceholderDesc.textContent = t('previewNoneDesc');
  }

  // Activity log card
  const logCardTitle = document.querySelector('.log-card .card-title');
  if (logCardTitle) {
    logCardTitle.innerHTML = `<i class="fas fa-terminal"></i> ${t('activityLogTitle')}`;
  }

  // Footer
  const footerP = document.querySelector('footer p');
  if (footerP) {
    footerP.textContent = t('controllerFooterText');
  }
}


// Helper function to update element text
function updateElementText(selector, text) {
  const element = document.querySelector(selector);
  if (element) element.textContent = text;
}

// Helper function to update button text (preserving icon)
function updateButtonText(selector, iconClass, text) {
  const button = document.querySelector(selector);
  if (button) {
    button.innerHTML = `<i class="fas ${iconClass}"></i> ${text}`;
  }
}

// Change language
function changeLanguage(lang) {
  if (translations[lang]) {
    // Update all language references at once
    currentLanguage = lang;
    window.currentLanguage = lang;
    document.documentElement.lang = lang;
    
    // Save to localStorage (single key: 'language')
    localStorage.setItem('language', lang);
    
    // Update all page text
    updatePageLanguage();
    
    // Dispatch event for other scripts (like script.js audio)
    document.dispatchEvent(new CustomEvent('languageChanged', { 
      detail: { language: lang } 
    }));
    
    // Update active language button
    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    const activeBtn = document.querySelector(`[data-lang="${lang}"]`);
    if (activeBtn) activeBtn.classList.add('active');
    
    console.log('Language changed to:', lang);
  }
}

// Initialize language on page load
document.addEventListener('DOMContentLoaded', () => {
  // Apply translations to page
  updatePageLanguage();
  
  // Set active language button based on current language
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  const activeBtn = document.querySelector(`[data-lang="${currentLanguage}"]`);
  if (activeBtn) {
    activeBtn.classList.add('active');
  }
  
  console.log('Language system initialized:', currentLanguage);
});

// Export for use in other scripts
if (typeof window !== 'undefined') {
  window.translations = translations;
  window.t = t;
  window.changeLanguage = changeLanguage;
  window.getCurrentLanguage = () => currentLanguage;
}