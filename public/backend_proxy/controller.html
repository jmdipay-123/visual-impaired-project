<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Remote Control</title>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <h1>Remote Control</h1>

    <h2>Language</h2>
    <select id="lang">
      <option value="en">English</option>
      <option value="tl">Tagalog</option>
      <option value="ceb">Cebuano</option>
    </select>
    <button id="applyLangBtn">Apply Language</button>

    <h2>Camera</h2>
    <button id="startCamBtn">Start Camera</button>
    <button id="stopCamBtn">Stop Camera</button>

    <h2>Live Preview (slow)</h2>
    <img
      id="previewImage"
      alt="Camera preview"
      style="max-width: 100%; border: 1px solid #ccc;"
    >


    <hr />
    <pre id="log" style="background:#111;color:#0f0;padding:8px;height:150px;overflow:auto;font-size:12px;"></pre>

    <script>
      const targetDeviceId = "vision-device-1";

      const logEl = document.getElementById("log");
      function log(...args) {
        console.log(...args);
        logEl.textContent += args.map(a => (typeof a === "string" ? a : JSON.stringify(a))).join(" ") + "\n";
        logEl.scrollTop = logEl.scrollHeight;
      }

      const socket = io({
        transports: ["websocket"],
      });

      socket.on("connect", () => {
        log("[controller] connected:", socket.id);
      });

      // ðŸ”¹ Tumanggap ng preview frames galing sa server
socket.on("previewFrame", (data) => {
  if (!data || data.deviceId !== targetDeviceId) return;
  const img = document.getElementById("previewImage");
  if (img && data.image) {
    img.src = data.image;
    log("[controller] previewFrame received");
  }
});


      // Helper to send commands
      function sendCommand(type, payload = {}) {
        const msg = {
          deviceId: targetDeviceId,
          command: {
            type,
            payload,
          },
        };
        socket.emit("sendCommand", msg);
        log("[controller] sendCommand:", msg);
      }

      // Language control
      document.getElementById("applyLangBtn").addEventListener("click", () => {
        const lang = document.getElementById("lang").value;
        sendCommand("SET_LANGUAGE", { lang });
      });

      // Camera control
      document.getElementById("startCamBtn").addEventListener("click", () => {
        sendCommand("START_CAMERA");
      });

      document.getElementById("stopCamBtn").addEventListener("click", () => {
        sendCommand("STOP_CAMERA");
      });

      // (optional) Just log any command echo back if you add that later
      socket.on("command", (cmd) => {
        log("[controller] command event:", cmd);
      });


    </script>
  </body>
</html>
